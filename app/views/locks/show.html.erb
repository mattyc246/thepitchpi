<div>
  <meta charset='utf-8' />
  <title>Locate the user</title>
  <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
  <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.49.0/mapbox-gl.js'></script>
  <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.49.0/mapbox-gl.css' rel='stylesheet' />
  <style>
  body { margin:0; padding:0;}
  #map {width:100%;height:400px }
  </style>
</div>


<h2>Details of lock</h2>
<div>
<table>
    <tr>
        <th>Lock Name</th>
        <th>Status</th>
        <th>Group</th>
        <th>Location</th>
        <th>Delete Lock</th>
    </tr>
    <tr>
        <td><%= @lock.lock_name %></td>
        <td><%= @lock.status %></td>
        <td><%= @lock.group %></td>
        <td><%= @lock.location %></td>
        <td>Delete</td>
   </tr>
</table>
</div>




<div id='map'></div>



<button class="find_location" type="button">Find Location</button>








<script>




mapboxgl.accessToken = 'pk.eyJ1IjoibG9ja25yb2xscy10ZWFtMSIsImEiOiJjam4xM3FvcDYxYnZuM2ttOThyYTc2cjFwIn0.LXhAvekTPkv8HSJvQd-32w';
var map = new mapboxgl.Map({
    container: 'map', // container id
    style: 'mapbox://styles/mapbox/dark-v9',
    center: [<%= @lock.longitude %>, <%= @lock.latitude %>], // starting position
    zoom: 15 // starting zoom
});


// existing locks tags into map-------------------------------------
var geojson = {
  type: 'FeatureCollection',
  features: [{
    type: 'Feature',
    geometry: {
      type: 'Point',
      coordinates: [<%= @lock.longitude %>, <%= @lock.latitude %>]
    },
    properties: {
      title: "<%= @lock.lock_name %>",
      group: "<%= @lock.group %>",
      description: "<%= @lock.status %>"
    }
  }]
};

// add visual to lock tag popup-----
geojson.features.forEach(function(marker) {

  // create a HTML element for each feature
  var el = document.createElement('div');
  el.className = 'marker';

  // make a marker for each feature and add to the map
  new mapboxgl.Marker(el)
    .setLngLat(marker.geometry.coordinates)
    .setPopup(new mapboxgl.Popup({ offset: 25 }) // add popups
    .setHTML('<h5>' + marker.properties.title + '</h5><small>' + marker.properties.group + '</small><h4>' + marker.properties.description + '</h4>'))
    .addTo(map);
});





// Add geolocate control to the map.----------------------------------------
map.addControl(new mapboxgl.GeolocateControl({
    positionOptions: {
        enableHighAccuracy: true
    },
    trackUserLocation: true
}));






// send geolocation to backend------------------------------------------------
$(".find_location").click(function() {
  if (navigator.geolocation)
     {
     navigator.geolocation.getCurrentPosition(useGeoData);
     }
});

function useGeoData(position){
   var lng = position.coords.longitude;
   var lat = position.coords.latitude;
   console.log(lng)
   console.log(lat)


 }



</script>
